<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>TrendTracker – Watchlist</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <style>
    body {
      background-color: #e5e7eb;
      color: #111827;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .navbar {
      background: linear-gradient(90deg, #0A1A44, #009FE3);
    }
    .navbar .nav-link {
      color: #e5e7eb;
      font-weight: 500;
    }
    .navbar .nav-link.active {
      background-color: rgba(255,255,255,0.2);
    }
    .brand-accent {
      color: #ffffff;
      font-weight: 700;
    }
    .card {
      background-color: #ffffff;
      border-radius: 18px;
      border: 1px solid #d1d5db;
      transition: all .15s ease-out;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(15, 23, 42, .15);
    }
    .badge-site {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      border-radius: 6px;
      padding: 4px 8px;
    }
    .btn-outline-dark-bmw {
      border-radius: 999px;
      border: 1px solid #111827;
      color: #111827;
      background-color: #ffffff;
      font-weight: 500;
      padding-inline: 1.2rem;
    }
    .btn-outline-dark-bmw:hover {
      background-color: #111827;
      color: #ffffff;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-dark mb-4">
  <div class="container-fluid">
    <a class="navbar-brand mb-0 h1" href="/">
      Trend<span class="brand-accent">Tracker</span>
    </a>
    <ul class="nav nav-pills">
      <li class="nav-item">
        <a class="nav-link" href="/">Search</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if request.path.startswith('/watch') %}active{% endif %}" href="/watch">Watching</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if request.path == '/analytics' %}active{% endif %}" href="/analytics">Analytics</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if request.path == '/profile' %}active{% endif %}" href="/profile">Profile</a>
      </li>
    </ul>
  </div>
</nav>

<div class="container mb-5">
  <!-- Rules list -->
  <div class="row mb-4">
    <div class="col-lg-8 mx-auto">
      <h4 class="mb-3">Your watch rules</h4>

      {% if not rule_summaries %}
        <p class="text-secondary">
          No watch rules yet. Go back to the Search tab and click <strong>Add to Watching</strong> on a listing you like.
        </p>
      {% else %}
        {% for rs in rule_summaries %}
        <a href="/watch/{{ rs.rule.id }}" style="text-decoration: none; color: inherit;">
          <div class="card p-3 mb-3">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div><strong>{{ rs.rule.query }}</strong></div>
                <div class="text-secondary" style="font-size: 0.85rem;">
                  Tags:
                  {% if rs.rule.tags %}
                    {{ rs.rule.tags|join(", ") }}
                  {% else %}
                    None
                  {% endif %}
                  · Max:
                  {% if rs.rule.max_price %}
                    {{ rs.rule.max_price }}
                  {% else %}
                    No limit
                  {% endif %}
                  · Sites: {{ rs.rule.sites|join(", ") }}
                </div>
              </div>
              <div class="text-end">
                <div style="font-size: 0.9rem;">
                  {{ rs.summary.total }} current matches
                </div>
                {% if rs.summary.avg_price_overall %}
                <div class="text-secondary" style="font-size: 0.8rem;">
                  Avg: ${{ "%.2f"|format(rs.summary.avg_price_overall) }}
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </a>
        {% endfor %}
      {% endif %}
    </div>
  </div>

  <!-- New matches / notifications -->
  <div class="row mb-4">
    <div class="col-lg-10 mx-auto">
      <h4 class="mb-3">New matches</h4>

      {% if not notifications %}
        <p class="text-secondary">
          No new items yet. Refresh this page later to check again.
        </p>
      {% else %}
        {% for block in notifications %}
<div class="mb-3">
  <h6>
    Rule: <strong>{{ block["rule"]["query"] }}</strong>
    <span class="badge bg-success ms-2">New items</span>
  </h6>
  <div class="row">
    {% for item in block["items"] %}
    <div class="col-md-6 col-lg-4 mb-2">
      <div class="card p-3 h-100">
        <div class="mb-1 text-secondary small">
          {{ item.site }}
        </div>
        <div class="mb-1"><strong>{{ item.title }}</strong></div>
        <div class="mb-1">
          {% if item.price is not none %}
            {{ item.currency }} {{ "%.2f"|format(item.price) }}
          {% else %}
            –
          {% endif %}
        </div>
        {% if item.url %}
        <a href="{{ item.url }}" target="_blank" class="btn btn-outline-dark-bmw btn-sm mt-auto">
          View listing
        </a>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endfor %}
      {% endif %}
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
